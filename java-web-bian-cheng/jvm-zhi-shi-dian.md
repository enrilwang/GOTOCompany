# JVM知识点

1 谈谈对JVM的理解？java8虚拟机和之前的变化更新

2 什么是OOM，什么是栈溢出？怎么分析

3 JVM的常用调优参数有哪些

4 内存快照如何抓取，怎么分析Dump文件

5 谈谈jvm中，类加载器的认识





```text
类加载器：
虚拟机自带的加载器，启动类（根）加载器，application加载器，扩展类加载器
external下面有个rt.jar包，里面有所有的class

双亲委派机制：安全的
APP---》EXC ----》BOOTSTRAP（最终执行根加载器）
1 类加载器收到类加载的请求
2 将这个请求向上委托给父类加载器去完成，一直向上委托，直到启动类加载器boot
3 启动加载器检查是否能够加载当前这个类，能加载就结束，否则抛出异常，通知子加载器进行加载
4 重复步骤3

会去寻找对应上层的classloader尝试加载。
好处：1通过委派的方式，可以避免类的重复加载 2通过双亲委派的方式，保证了安全性。
类加载器之间是组合关系





jvm堆
堆内存细分为三个区域：新生区（eden区，surviveTo，surviveFrom），老年区，永久区（元空间）
新生区（eden区）触发minor GC， 老年区满了触发Full GC
jdk1.8之后：无永久代，常量池在元空间，这个区域不存在垃圾回收，关闭JVM虚拟机就会释放这个区域的内存
虚拟机默认情况下分配的总内存是电脑的总内存的1/4，而初始化的内存为1/64
-Xms1024m -Xmx1024m这个是调jvm的最大和初始化的内存大小
-Xms8m -Xmx8m -XX:+PrintGCDetails

jvm调优和分析：Jprofiler（内存快照分析工具）
当在一个项目中出现了OOM错误，该如何排除？
MAT，Jprofiler作用：分析Dump内存文件，快速定位内存泄露，获得堆中的数据，获得大的对象
-Xms：设置初始化内存
-Xmx：设置最大分配内存
-Xms1m -Xmx8m -XX:+HeapDumpOnOutOfMemoryError  当出现oom输出dump文件

新生代常用算法，复制清除算法

标记清除算法：对没有标记的对象进行清除，容易造成内存碎片，优点是不需要额外的空间
标记压缩算法：解决内存碎片的问题，
分代收集算法：新生代用复制，老年代用标记清除压缩混合





```

## JVM编译优化技术：逃逸分析

逃逸分析主要就是分析对象动态作用域，如果能证明一个对象不会逃逸到方法或线程之外，也就是别的方法或线程无法通过任何途径访问到这个对象，则可能为这个变量进行一些高效的优化，优化的手段有

1。栈上分配：因为java堆中的对象对于各个线程都是共享和可见的，jvm进行回收和整理内存都需要消耗时间，如果确定了一个对象不会逃逸出方法之外，把它分配到栈上，那么这个对象可以随着方法的结束而自动销毁了。

2。同步消除：线程同步本身是一个相对耗时的过程，如果逃逸分析能够确定一个变量不会逃逸出线程，无法被其他线程访问，那这个变量的读写肯定就不会有竞争，对这个变量实施的同步措施也就可以消除掉。

3。标量替换：java中的原始数据类型，可以被称为标量。相对的如果一个数据可以继续分解，那他就称作聚合量，java中的对象就是典型的聚合量。根据程序访问的情况，把一个对象拆散，将其使用到的成员变量恢复原始类型来访问就叫做标量替换。

