# 网络5层

各层完成的主要功能

1. 差错控制：相应层次对等方的通信更加可靠
2. 流量控制：发送端的发送速率必须使接收端来得及接收
3. 分段和重装：发送端将要发送的数据块划分为更小的单位，在接收端将其还原
4. 复用和分用：发送端几个高层会话复用一条低层的连接，在接收端再进行分用
5. 连接建立和释放：交换数据前先建立一条逻辑连接，数据传送结束后释放连接

## 物理层（最底层）

* 信道：表示某一个方向传送的媒体
* 单向通信（单工通信）：只能有一个方向的通信而没有反方向的交互
* 双向交替通信（半双工通信）：通信的双方都可以发送信息，但不能同时发送和同时接受
* 双向同时通信（全双工通信）：通信双方可以同时发送和接收信息

## 数据链路层（传送的是帧）

点对点信道：使用**一对一**的点对点通信方式

广播信道：使用**一对多**的广播通信方式，过程比较复杂。

不同的链路层可能采用不同的数据链路层协议

数据链路层协议有许多种，但有三个基本问题则是共同的

1. 封装成帧 ：在一段数据的前后分别添加首部和尾部（进行帧定界用特殊的帧定界符），然后就构成了一个帧。
2. 透明传输 ：解决透明传输的问题用的是**字节填充**或者**字符填充**，当发送端出现了控制字符“SOH“或“EOT“时，都在前面插入转义字符，这样子就能够继续识别头部和尾部了
3. 差错控制：在传输过程中可能会产生比特差错，1可能会变成0，0可能会变成1。在数据链路层传送的帧中，广泛使用了**循环冗余检验**CRC的检错技术

**数据链路层是不能实现可靠传输（不重复，不丢失，不失序）的，这一步将会交由网络层来负责:意思就是链路层可以保证bit交付但不能确定对方传的就是对的**





## 网络层（路由器就在这一层，只需要尽最大努力去交付，不需要实现可靠传输）

网络层的两种服务：**面向连接**和**无连接**

一种观点：网络层可以提供可靠传输（依靠虚电路），但是同时带来的缺点就是资源要等待。（现在的网络不用这种）

另一种观点：网络层向上只提供简单灵活的，无连接，尽最大努力交付的数据报服务。意思就是不提供服务质量的承诺，即所传送的分组可能出错，丢失，重复和失序（不按序到达终点）。如果端系统中的进程之间的通信需要是可靠的，那么就由网络的主机中的运输层负责可靠交付包括差错处理，流量控制等。好处就是：网络的造价大大降低，运行方式灵活，能够适应多种应用。

IP地址：是给每个连接在互联网上的主机分配一个在全世界范围是唯一的**32位**的标识符。IP地址现在由互联网名字和数字分配机构ICANN进行分配

两级的IP地址结构如下：网络号+主机号 

三级IP地址是：网络号（不变） + （子网号+主机号）



IPV6：从IPV4的32位变成了现在的128位 说明有更大的地址空间，使用**冒号十六进制**记法



## 运输层（实现可靠传输的地方，交给两端主机中的进程）

可以提供可靠和不可靠交付，最重要的功能----复用和分用

IP地址加端口号可以找到互联网上唯一主机的唯一进程

### **面向连接的TCP**：

不提供广播或多播服务，特点就是：提供全双工通信，面向字节流，TCP根据对方给出的**窗口值**和当前**网络拥塞**的程度来决定一个报文段应包含多少个字节。_连接的端点叫做套接字socket。_

socket = IP地址加端口号，

#### 可靠传输的工作原理

#### 停止等待协议如下

1。无差错情况，A发送分组M1，发送完等B的确认（ACK），A收到完继续发送下一个分组M2。

2。出现差错：解决方法：超时重传，A每次发送数据都有个超时计时器开始计时，超时了就重新发送。

缺点信道利用率不高，大部分时间都在等待

#### 流水线传输：

一直传输数据，连续发送，自动重传，连续ARQ协议（滑动窗口协议），接收方一般采用**累计确认**的方式，对**按序到达的最后一个分组**发送确认。

TCP连接的每一段都必须有两个窗口------**发送窗口**和**接收窗口**，TCP的可靠机制用**字节的序号**进行控制

TCP的流量控制：利用滑动窗口实现流量控制，发送方发送数据希望接收方来得及接收，所以窗口大小会和接收方保持一致。

TCP的拥塞控制：防止过多的数据注入到网络中，使网络中的路由器或链路不致过载。拥塞控制算法：**慢开始，拥塞避免，快重传，快恢复**

\_\_

### 无连接的UDP：

最有效的工作方式，复用分用和差错检测，使用尽最大努力交付，面向报文的，没有拥塞控制，它是**一次交付一个完整**的报文







