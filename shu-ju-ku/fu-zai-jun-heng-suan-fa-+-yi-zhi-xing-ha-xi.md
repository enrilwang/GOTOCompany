# 负载均衡算法+一致性哈希

## 负载均衡算法有：

1随机：将key随机分配到某一个slot上

2加权随机：为每一个slot分配权重，

3轮询：按顺序依次进行分配

4加权轮询：为权重更高的分配更多的key

5最少连接数：将key分配给当前具有最少连接数量的slot

## 一致性哈希算法

当集群中节点的数量发生变化时，之前的映射规则就可能发生变化。如果集群中每个机器提供的服务没有差别，这不会有什么影响。**但对于分布式缓存这种的系统而言，映射规则失效就意味着之前缓存的失效，若同一时刻出现大量的缓存失效，则可能会出现 “缓存雪崩”，这将会造成灾难性的后果。要解决此问题，我们必须在其余节点上重新分配所有现有键，这可能是非常昂贵的操作（全量复制），并且可能对正在运行的系统产生不利影响。当然除了重新分配所有现有键的方案之外，还有另一种更好的方案即使用一致性哈希算法。**

**一致性哈希算法**是一种特殊的哈希算法，在移除或者添加一个服务器时，能够尽可能小地改变已存在的服务请求与处理请求服务器之间的映射关系。一致性哈希解决了简单哈希算法在分布式[哈希表](https://link.segmentfault.com/?url=https%3A%2F%2Fbaike.baidu.com%2Fitem%2F%25E5%2593%2588%25E5%25B8%258C%25E8%25A1%25A8%2F5981869)（Distributed Hash Table，DHT）中存在的动态伸缩等问题 

优点：1节省了数据移动的开销 2管理数据（利用虚拟节点的思想）

### 原理

一致性哈希算法（md5）通过一个叫作一致性哈希环的数据结构实现。这个环的起点是 0，终点是 2^32 - 1 or 2^64 -1 都可以，并且起点与终点连接，故这个环的整数分布范围是 \[0, 2^32-1\]

实际操作：把缓存服务器（通过IP地址或者host），放置于哈希环内，当添加数据时，哈希过后，顺时针线性搜索到最近的机器节点，他就属于这个节点

虚拟节点：当多台服务器不是平均分的时候，需要虚拟节点解决负载不均衡的问题。

